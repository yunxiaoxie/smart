"use strict";angular.module("iRestApp",["ngMessages","ui.router","oc.lazyLoad","ui.bootstrap","iRestApp.basicServer"]),angular.module("iRestApp.basicServer",[]).controller("LoginCtrl",["$scope","$rootScope","$window","UtilsService","$location","$log","AlertService","$state",function(e,t,n,r,o,i,s,a){e.loadLoginCode=function(){e.LogincodeData={};var t="test/checkcode.json";r.queryService(t,"get","").success(function(e){1e4===e.msgNo}).error(function(){console.log("LoadLogincode   failed")})},e.login=function(){r.query("/verifyUser",e.formData).then(function(e){1e4===e.data.msgNo?(i.info("Login successed."),s.clean(),a.go("Main")):(i.info("Login failed."),s.alert("用户名或密码错误"))},function(){i.error("Request failed.")})}}]).factory("UtilsService",["$http","$q",function(e,t){return{query:function(t,n,r){return r?r:r="post",e({url:t,data:n,cache:!1,method:r,ignoreLoadingBar:!1})},querySync:function(n,r,o){o?o:o="post";var i=t.defer();return e({url:n,data:r,cache:!1,method:o,ignoreLoadingBar:!1}).success(function(e,t,n,r){i.resolve(e)}).error(function(e,t,n,r){i.reject(e)}),i.promise}}}]).factory("AlertService",["$rootScope",function(e){var t={};return e.alerts=[],t.alert=function(n,r){r||(r="info"),e.alerts.push({type:r,msg:n,close:function(){t.closeAlert(this)}})},t.closeAlert=function(n){t.closeAlertIdx(e.alerts.indexOf(n))},t.closeAlertIdx=function(t){e.alerts.splice(t,1)},t.clean=function(){e.alerts=[]},t}]).factory("SessionService",["$rootScope",function(e){var t={};return t.isAnonymus=function(){return e.configures.accessToken=t.token="afasfdasfd",!1},t}]).factory("HttpInterceptor",["$q","AlertService",function(e,t){return{request:function(e){return e},requestError:function(t){return e.reject(t)},response:function(e){return e},responseError:function(n){return-1===n.status?t.alert("远程服务器无响应","warning"):500===n.status?t.alert("500","warning"):501===n.status?t.alert("501","warning"):t.alert("未知系统故障！","warning"),e.reject(n)}}}]).factory("SessionInjector",["SessionService",function(e){var t={request:function(t){return e.isAnonymus()||(t.headers["X-Session-Token"]=e.token),t}};return t}]).factory("TimestampMarker",[function(){var e={request:function(e){return e.requestTimestamp=(new Date).getTime(),e},response:function(e){return e.config.responseTimestamp=(new Date).getTime(),e}};return e}]).factory("EncryptInterceptor",["$log",function(e){return{request:function(t){return e.info("encryption..."),t},response:function(t){return e.info("decryption..."),t}}}]).factory("UrlInterceptor",["$log",function(e){return{request:function(t){return t.url&&"/"===t.url.substr(0,1)&&(e.info("request url:"+t.url),t.url="http://127.0.0.1:3000/"+t.url),t}}}]),angular.module("iRestApp").config(["$ocLazyLoadProvider",function(e){e.config({debug:!1,events:!0,modules:[{name:"mainModule",files:["dist/js/controllers/main-controllers.min.js","dist/js/directives/main-directives.min.js","dist/js/interceptors/main-interceptors.min.js"]}]})}]),angular.module("iRestApp").config(["$stateProvider","$urlRouterProvider",function(e,t){e.state("Login",{url:"/Login",templateUrl:"html/login.html",views:{rootView:{templateUrl:"html/login.html"}}}).state("Main",{url:"/Main",templateUrl:"html/account/main.html",views:{rootView:{templateUrl:"html/account/main.html"}},resolve:{loadMyCtrl:["$ocLazyLoad",function(e){return e.load(["mainModule"])}]}}).state("Menu",{url:"/",views:{rootView:{templateUrl:"html/account/menu.html"}}}),t.otherwise("/Login")}]),angular.module("iRestApp").config(["$httpProvider","uibDatepickerConfig",function(e,t){t.showWeeks=!1,e.defaults.headers.get||(e.defaults.headers.get={}),e.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",e.defaults.headers.get["Cache-Control"]="no-cache",e.defaults.headers.get.Pragma="no-cache",e.interceptors.push("UrlInterceptor"),e.interceptors.push("EncryptInterceptor"),e.interceptors.push("TimestampMarker"),e.interceptors.push("SessionInjector"),e.interceptors.push("HttpInterceptor")}]),angular.module("iRestApp").run(["$rootScope","$location","$state","$window",function(e,t,n,r){e.configures={baseUrl:"/",backgound:!1,pageDefaultSize:parseInt(r.localStorage.page_size)||10,pageAllSize:1e4,asideMenu:!0,asideMenuShow:!0,username:r.sessionStorage.topName||"",account:{user_id:r.sessionStorage.user_id,role_id:r.sessionStorage.role_id,username:r.sessionStorage.username},buttonSub:!0,sysPage:"page-login",lang:r.localStorage.i18n_key||"zh_CN.UTF-8",accessToken:r.sessionStorage.accessToken,macAddress:r.sessionStorage.macAddress,macStatus:!0},e.location=t,e.$on("relogin",function(){n.go("Login")});var o=e.menuConfig={mainState:["Account","Wifi","Login","Menu","Vds","Ad","Cms"],subMenuFilter:["Add","Edit","Clone","Add1","Edit1","Add2","Edit2","RightsSet","View","DevicePortsShow","DomainAdd","StaticAdd","StaticEdit","DomainEdit"],asideMenuFilter:["Device","Video","Book","Ad","Model"],mainWorks:["Account","Wifi","Vds","Ad","Cms"]};e.$on("$stateChangeStart",function(t,r,i,s,a){var c=r.name.split(".")[0],u=(s.name.split(".")[0],_.last(r.url.split("/"),_.keys(i).length+1)[0]),l=_.initial(r.url.split("/"),_.keys(i).length+(_.indexOf(o.subMenuFilter,u)>=0?1:0));_.last(l),"/"+c+l.join("/"),_.last(s.url.split("/"),_.keys(a).length+1)[0];if(!e.configures.accessToken&&"Login"!=r.name)return t.preventDefault(),e.configures.toState=r.name,void n.go("Login")})}]);