"use strict";function FormDirectiveFactory(){return["$log",function(e){return{restrict:"EA",scope:!0,replace:!0,templateUrl:function(t,r){var n=t[0].localName;return n&&n.indexOf("select")!==-1?"html/qk-select.html":n&&n.indexOf("radio")!==-1?"html/qk-radio.html":n&&n.indexOf("checkbox")!==-1?"html/qk-checkbox.html":n&&n.indexOf("date")!==-1?"html/qk-date-picker.html":(e.error("Not supported type:",n),"")},controllerAs:"vm",bindToController:{required:"=",model:"="},controller:["$scope","$element","$attrs","$log","UtilsService",function(e,t,r,n,o){this.getData=function(){r.code&&o.querySync("/getDataByCode",{code:r.code}).then(function(t){e.data=t},function(){n("Not supported code:",r.code)})},this.format="yyyy-MM-dd",this.popup={opened:!1},this.open=function(){this.popup.opened=!0},this.disabled=function(e,t){return"day"===t&&(0===e.getDay()||6===e.getDay())}}]}}]}angular.module("iRestApp",["ngMessages","ui.bootstrap","iRestApp.basicServer"]),angular.module("iRestApp.basicServer",[]).controller("FormCtrl",["$scope","$filter","$http","UtilsService","alertService",function(e,t,r,n,o){var i=t("date");e.submitted=!1,e.isShow=function(t){return e.submitted||t.$dirty},e.slt="请选择",e.select=function(t,r){console.log(t,r),e.slt=t},e.submit=function(){e.submitted=!0,o.add("warning","This is a warning."),o.add("danger","This is an error!"),console.log(i(e.formData.birthday,"yyyy-MM-dd")),r.post("/formSave",e.formData).success(function(e){alert(JSON.stringify(e))}).error(function(e){alert("failure message:"+JSON.stringify({data:e}))})}}]).directive("qkSelect",FormDirectiveFactory()).directive("qkRadio",FormDirectiveFactory()).directive("qkCheckbox",FormDirectiveFactory()).directive("qkDatePicker",FormDirectiveFactory()).directive("timeDuration",function(){var e="<div class='input-inline'>             <input class='form-control' type='text' ng-model='num' />             <select class='form-control' ng-model='unit'>                 <option value='seconds'>Seconds</option>                 <option value='minutes'>Minutes</option>                 <option value='hours'>Hours</option>                 <option value='days'>Days</option>             </select>            </div>";return{restrict:"E",template:e,require:"ngModel",replace:!0,link:function(e,t,r,n){var o={seconds:1,minutes:60,hours:3600,days:86400},i=["seconds","minutes","hours","days"];n.$formatters.push(function(e){var t,r,n="minutes",a=0;for(e=parseInt(e||0),t=i.length-1;t>=0;t--)if(r=i[t],e%o[r]===0){n=r;break}return e&&(a=e/o[n]),{unit:n,num:a}}),n.$parsers.push(function(e){var t,r=e.unit,n=e.num;return t=o[r],n*t}),e.$watch("unit + num",function(){n.$setViewValue({unit:e.unit,num:e.num})}),n.$render=function(){n.$viewValue||(n.$viewValue={unit:"hours",num:1}),e.unit=n.$viewValue.unit,e.num=n.$viewValue.num}}}}).directive("charValid",[function(){return{restrict:"A",require:"?ngModel",link:function(e,t,r,n){n&&(n.$validators.charValid=function(e,t){var r=/[`~!@#$%^&*()+<>?:"{},.\/;\='[\]]/im;return!r.test(e)})}}}]).directive("noDuplicate",[function(){return{restrict:"A",require:"?ngModel",link:function(e,t,r,n){n&&(n.$validators.noDuplicate=function(t,n){if(e.formData){var o=e.formData.list,i=[],a=r.name;if(o){var s=_.keys(o);_.each(s,function(e,r){e===a?i.push(t):i.push(o[e])})}if(i.length!==_.uniq(i).length)return!1}return!0})}}}]).directive("noRepeat",[function(){return{require:"ngModel",link:function(e,t,r,n){var o=[];e.$watch(r.ngModel,function(t){if(!(e.formData.domain_addr_pairs&&e.formData.domain_addr_pairs.length<=1))return o=_.pluck(e.formData.domain_addr_pairs,"domain"),o.length==_.uniq(o).length?void n.$setValidity("noRepeat",!0):void n.$setValidity("noRepeat",!1)})}}}]).directive("myMinLength",function(){return{restrict:"A",require:"?ngModel",link:function(e,t,r,n){if(n){var o=0;r.$observe("myminlength",function(e){o=parseInt(e)||0,n.$validate()}),n.$validators.myminlength=function(e,t){return n.$isEmpty(t)||t.length>=o}}}}}).directive("ipMatch",["$timeout",function(e){return{restrict:"A",require:"?ngModel",link:function(e,t,r,n){n&&(n.$validators.ipmatch=function(e,t){var r=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;return n.$isEmpty(t)||r.test(e)})}}}]).directive("qkModel",["$compile",function(e){var t="qk-model";return{restrict:"A",terminal:!0,priority:1e5,controller:["$scope","$element","$attrs","$parse",function(e,r,n,o){this.getData=function(){return n.hassubscope&&"true"===n.hassubscope?(console.log(o(r.attr(t))(e)),"$parent."+o(r.attr(t))(e)):o(r.attr(t))(e)}}],link:function(r,n,o,i){var a=i.getData(),s=a?a:n.attr(t);n.removeAttr(t),n.attr("ng-model",s),e(n)(r)}}}]).factory("UtilsService",["$http","$q",function(e,t){return{query:function(t,r,n){return n?n:n="post",e({method:n,url:t,data:r,cache:!1,ignoreLoadingBar:!1})},querySync:function(r,n,o){o?o:o="post";var i=t.defer();return e({method:o,url:r,data:n,cache:!1,ignoreLoadingBar:!1}).success(function(e,t,r,n){i.resolve(e)}).error(function(e,t,r,n){i.reject(e)}),i.promise}}}]).factory("alertService",function(e){var t={};return e.alerts=[],t.add=function(r,n){e.alerts.push({type:r,msg:n,close:function(){t.closeAlert(this)}})},t.closeAlert=function(r){t.closeAlertIdx(e.alerts.indexOf(r))},t.closeAlertIdx=function(t){e.alerts.splice(t,1)},t}).factory("errorInterceptor",["$rootScope","$window","$q","$log",function(e,t,r,n){return{request:function(e){return e.url&&"/"===e.url.substr(0,1)&&(n.info(e.url),e.url="http://127.0.0.1:3000/"+e.url),e},response:function(t){if(!t.data)return t;"POST"==t.config.method&&e.$broadcast("formPosted",t.config.url);var r=[12001,12002,12003];if(t.data.msgNo)var n=parseInt(t.data.msgNo),o=t.data.msg;else var n=1e4;switch(n){case 1e4:"DELETE"==t.config.method.toUpperCase()&&200==t.status&&e.$broadcast("msgError",900001);break;case 10005:e.$broadcast("relogin"),e.$broadcast("msgError",n,o);break;case 10006:e.$broadcast("relogin"),e.$broadcast("msgError",n,o);break;case 10007:e.$broadcast("relogin"),e.$broadcast("msgError",n,o);break;default:_.indexOf(r,n)<0&&e.$broadcast("msgError",n,o)}return t}}}]),angular.module("iRestApp").config(["$httpProvider","uibDatepickerConfig",function(e,t){t.showWeeks=!1,e.defaults.headers.get||(e.defaults.headers.get={}),e.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",e.defaults.headers.get["Cache-Control"]="no-cache",e.defaults.headers.get.Pragma="no-cache",e.interceptors.push("errorInterceptor")}]),angular.module("iRestApp.mainInterceptors",[]).factory("errorInterceptor",["$rootScope","$window","$q",function(e,t,r){return{request:function(e){return e.url+="http://127.0.0.1:3000",e},response:function(t){if(!t.data)return t;"POST"==t.config.method&&e.$broadcast("formPosted",t.config.url);var r=[12001,12002,12003];if(t.data.msgNo)var n=parseInt(t.data.msgNo),o=t.data.msg;else var n=1e4;switch(n){case 1e4:"DELETE"==t.config.method.toUpperCase()&&200==t.status&&e.$broadcast("msgError",900001);break;case 10005:e.$broadcast("relogin"),e.$broadcast("msgError",n,o);break;case 10006:e.$broadcast("relogin"),e.$broadcast("msgError",n,o);break;case 10007:e.$broadcast("relogin"),e.$broadcast("msgError",n,o);break;default:_.indexOf(r,n)<0&&e.$broadcast("msgError",n,o)}return t}}}]);