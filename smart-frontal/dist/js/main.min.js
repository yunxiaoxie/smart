"use strict";function FormDirectiveFactory(){return["$log",function(e){return{restrict:"EA",scope:!0,replace:!0,templateUrl:function(t,r){var o=t[0].localName;return o&&o.indexOf("select")!==-1?"html/qk-select.html":o&&o.indexOf("radio")!==-1?"html/qk-radio.html":o&&o.indexOf("checkbox")!==-1?"html/qk-checkbox.html":o&&o.indexOf("date")!==-1?"html/qk-date-picker.html":(e.error("Not supported type:",o),"")},controllerAs:"vm",bindToController:{required:"=",model:"="},controller:["$scope","$element","$attrs","$log","UtilsService",function(e,t,r,o,n){this.getData=function(){r.code&&n.querySync("/getDataByCode",{code:r.code}).then(function(t){e.data=t},function(){o("Not supported code:",r.code)})},this.format="yyyy-MM-dd",this.popup={opened:!1},this.open=function(){this.popup.opened=!0},this.disabled=function(e,t){return"day"===t&&(0===e.getDay()||6===e.getDay())}}]}}]}angular.module("iRestApp",["ngMessages","ui.bootstrap","iRestApp.basicServer"]),angular.module("iRestApp.basicServer",[]).controller("FormCtrl",["$scope","$filter","$http","UtilsService","alertService",function(e,t,r,o,n){var a=t("date");e.submitted=!1,e.isShow=function(t){return e.submitted||t.$dirty},e.submit=function(){e.submitted=!0,n.add("warning","This is a warning."),n.add("danger","This is an error!"),console.log(a(e.formData.birthday,"yyyy-MM-dd")),r.post("/formSave",e.formData).success(function(e){alert(JSON.stringify(e))}).error(function(e){alert("failure message:"+JSON.stringify({data:e}))})}}]).directive("qkSelect",FormDirectiveFactory()).directive("qkRadio",FormDirectiveFactory()).directive("qkCheckbox",FormDirectiveFactory()).directive("qkDatePicker",FormDirectiveFactory()).directive("timeDuration",function(){var e="<div class='input-inline'>             <input class='form-control' type='text' ng-model='num' />             <select class='form-control' ng-model='unit'>                 <option value='seconds'>Seconds</option>                 <option value='minutes'>Minutes</option>                 <option value='hours'>Hours</option>                 <option value='days'>Days</option>             </select>            </div>";return{restrict:"E",template:e,require:"ngModel",replace:!0,link:function(e,t,r,o){var n={seconds:1,minutes:60,hours:3600,days:86400},a=["seconds","minutes","hours","days"];o.$formatters.push(function(e){var t,r,o="minutes",i=0;for(e=parseInt(e||0),t=a.length-1;t>=0;t--)if(r=a[t],e%n[r]===0){o=r;break}return e&&(i=e/n[o]),{unit:o,num:i}}),o.$parsers.push(function(e){var t,r=e.unit,o=e.num;return t=n[r],o*t}),e.$watch("unit + num",function(){o.$setViewValue({unit:e.unit,num:e.num})}),o.$render=function(){o.$viewValue||(o.$viewValue={unit:"hours",num:1}),e.unit=o.$viewValue.unit,e.num=o.$viewValue.num}}}}).directive("chaValid",["$timeout",function(e){return{require:"ngModel",link:function(t,r,o,n){var a;t.$watch(o.ngModel,function(t){return t?(e.cancel(a),void(a=e(function(){var e,r=/[`~!@#$%^&*()+<>?:"{},.\/;\='[\]]/im;return e=!r.test(t),n.$setValidity("chaValid",e),e?t:void 0},300))):void n.$setValidity("chaValid",!0)})}}}]).directive("qkModel",["$compile",function(e){var t="qk-model";return{restrict:"A",terminal:!0,priority:1e5,controller:["$scope","$element","$attrs","$parse",function(e,r,o,n){this.getData=function(){return o.hassubscope&&"true"===o.hassubscope?(console.log(n(r.attr(t))(e)),"$parent."+n(r.attr(t))(e)):n(r.attr(t))(e)}}],link:function(r,o,n,a){var i=a.getData(),s=i?i:o.attr(t);o.removeAttr(t),o.attr("ng-model",s),e(o)(r)}}}]).factory("UtilsService",["$http","$q",function(e,t){return{query:function(t,r,o){return o?o:o="post",e({method:o,url:t,data:r,cache:!1,ignoreLoadingBar:!1})},querySync:function(r,o,n){n?n:n="post";var a=t.defer();return e({method:n,url:r,data:o,cache:!1,ignoreLoadingBar:!1}).success(function(e,t,r,o){a.resolve(e)}).error(function(e,t,r,o){a.reject(e)}),a.promise}}}]).factory("alertService",function(e){var t={};return e.alerts=[],t.add=function(r,o){e.alerts.push({type:r,msg:o,close:function(){t.closeAlert(this)}})},t.closeAlert=function(r){t.closeAlertIdx(e.alerts.indexOf(r))},t.closeAlertIdx=function(t){e.alerts.splice(t,1)},t}).factory("errorInterceptor",["$rootScope","$window","$q","$log",function(e,t,r,o){return{request:function(e){return e.url&&"/"===e.url.substr(0,1)&&(o.info(e.url),e.url="http://127.0.0.1:3000/"+e.url),e},response:function(t){if(!t.data)return t;"POST"==t.config.method&&e.$broadcast("formPosted",t.config.url);var r=[12001,12002,12003];if(t.data.msgNo)var o=parseInt(t.data.msgNo),n=t.data.msg;else var o=1e4;switch(o){case 1e4:"DELETE"==t.config.method.toUpperCase()&&200==t.status&&e.$broadcast("msgError",900001);break;case 10005:e.$broadcast("relogin"),e.$broadcast("msgError",o,n);break;case 10006:e.$broadcast("relogin"),e.$broadcast("msgError",o,n);break;case 10007:e.$broadcast("relogin"),e.$broadcast("msgError",o,n);break;default:_.indexOf(r,o)<0&&e.$broadcast("msgError",o,n)}return t}}}]),angular.module("iRestApp").config(["$httpProvider","uibDatepickerConfig",function(e,t){t.showWeeks=!1,e.defaults.headers.get||(e.defaults.headers.get={}),e.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",e.defaults.headers.get["Cache-Control"]="no-cache",e.defaults.headers.get.Pragma="no-cache",e.interceptors.push("errorInterceptor")}]),angular.module("iRestApp.mainInterceptors",[]).factory("errorInterceptor",["$rootScope","$window","$q",function(e,t,r){return{request:function(e){return e.url+="http://127.0.0.1:3000",e},response:function(t){if(!t.data)return t;"POST"==t.config.method&&e.$broadcast("formPosted",t.config.url);var r=[12001,12002,12003];if(t.data.msgNo)var o=parseInt(t.data.msgNo),n=t.data.msg;else var o=1e4;switch(o){case 1e4:"DELETE"==t.config.method.toUpperCase()&&200==t.status&&e.$broadcast("msgError",900001);break;case 10005:e.$broadcast("relogin"),e.$broadcast("msgError",o,n);break;case 10006:e.$broadcast("relogin"),e.$broadcast("msgError",o,n);break;case 10007:e.$broadcast("relogin"),e.$broadcast("msgError",o,n);break;default:_.indexOf(r,o)<0&&e.$broadcast("msgError",o,n)}return t}}}]);